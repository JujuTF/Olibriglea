<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backoffice - Gest√£o de Pontos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/pontos.js"></script>
</head>
<body>
    <header>
        <nav>
            <div class="logo-backoffice">
                <div class="logo-small">
                    <img src="/mnt/user-data/uploads/logo.jpg" alt="Olibriglea">
                </div>
                <div>
                    <span class="logo-text">Olibriglea</span>
                    <span class="backoffice-badge">BACKOFFICE</span>
                </div>
            </div>
            <ul class="nav-menu">
                <li><a href="#" class="active">Pontos</a></li>
                <li><a href="#">Encomendas</a></li>
                <li><a href="#">Clientes</a></li>
                <li><a href="#">Relat√≥rios</a></li>
            </ul>
            <div class="user-info">
                <span>Ol√°, Brigite</span>
                <div class="user-avatar">B</div>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">üçΩÔ∏è</div>
                <div class="stat-info">
                    <h3>8</h3>
                    <p>Encomendas Hoje</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon gold">‚≠ê</div>
                <div class="stat-info">
                    <h3>15</h3>
                    <p>Pontos Dados Hoje</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">üë•</div>
                <div class="stat-info">
                    <h3>3</h3>
                    <p>Clientes Pr√≥ximos (9-10 pts)</p>
                </div>
            </div>
        </div>

        <!-- Search -->
        <div class="search-card">
            <h2>Gest√£o de Pontos</h2>
            <div class="search-form">
                <input type="text" class="search-input" id="searchInput" placeholder="C√≥digo, nome ou telem√≥vel..." value="OLI001">
                <button class="btn-search" onclick="searchCliente()">Pesquisar</button>
            </div>
        </div>

        <!-- Result -->
        <div class="result-card" id="resultCard">
            <h3>Resultado da Pesquisa</h3>
            <div class="cliente-info-card">
                <div class="cliente-header">
                    <div class="cliente-details">
                        <div class="cliente-codigo">OLI001</div>
                        <h4>Jo√£o Silva</h4>
                        <ul class="cliente-contatos">
                            <li>üìû 910 123 456</li>
                            <li>‚úâÔ∏è joao.silva@email.com</li>
                        </ul>
                        <div class="cliente-desde">Cliente desde: 15/10/2024</div>
                    </div>
                </div>

                <div class="pontos-display-bo">
                    <h5>Pontos Atuais:</h5>
                    <div class="pontos-circles-bo">
                        <div class="ponto-circle-bo filled">1</div>
                        <div class="ponto-circle-bo filled">2</div>
                        <div class="ponto-circle-bo filled">3</div>
                        <div class="ponto-circle-bo filled">4</div>
                        <div class="ponto-circle-bo filled">5</div>
                        <div class="ponto-circle-bo filled">6</div>
                        <div class="ponto-circle-bo filled">7</div>
                        <div class="ponto-circle-bo">8</div>
                        <div class="ponto-circle-bo">9</div>
                        <div class="ponto-circle-bo">10</div>
                    </div>
                    <div class="pontos-text">7/10 pontos</div>
                    <div class="ultima-refeicao">√öltima refei√ß√£o: 10/12/2024</div>
                </div>

                <div class="actions-row">
                    <button class="btn btn-add" onclick="adicionarPonto()">‚ûï Adicionar Ponto</button>
                    <a href="#" class="btn btn-secondary">üìã Ver Hist√≥rico</a>
                </div>
            </div>
        </div>

        <!-- Clientes Pr√≥ximos -->
        <div class="proximos-card">
            <h3>Clientes Pr√≥ximos do Resgate</h3>
            
            <div class="cliente-item">
                <div class="cliente-item-info">
                    <div class="cliente-item-nome">Ana Costa</div>
                    <div class="cliente-item-codigo">OLI015</div>
                </div>
                <div class="pontos-mini-display">
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini"></div>
                </div>
                <div class="pontos-count-display">9/10</div>
            </div>

            <div class="cliente-item">
                <div class="cliente-item-info">
                    <div class="cliente-item-nome">Pedro Silva</div>
                    <div class="cliente-item-codigo">OLI023</div>
                </div>
                <div class="pontos-mini-display">
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini"></div>
                    <div class="ponto-mini"></div>
                </div>
                <div class="pontos-count-display">8/10</div>
            </div>

            <div class="cliente-item">
                <div class="cliente-item-info">
                    <div class="cliente-item-nome">Maria Santos</div>
                    <div class="cliente-item-codigo">OLI008</div>
                </div>
                <div class="pontos-mini-display">
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini filled"></div>
                    <div class="ponto-mini"></div>
                    <div class="ponto-mini"></div>
                </div>
                <div class="pontos-count-display">8/10</div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Ponto -->
    <div class="modal" id="modalAdicionar">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Ponto</h3>
            </div>
            <div class="modal-body">
                <p><strong>Cliente:</strong> OLI001 - Jo√£o Silva</p>
                <p><strong>Pontos atuais:</strong> 7/10</p>
                <div class="info-box-modal">
                    Tem a certeza que quer adicionar <strong>1 ponto</strong> a este cliente?<br><br>
                    <strong>Ap√≥s adicionar:</strong> 8/10 pontos
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="fecharModal()">Cancelar</button>
                <button class="btn btn-confirm" onclick="confirmarPonto()">‚úì Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal Sucesso -->
    <div class="modal" id="modalSucesso">
        <div class="modal-content">
            <div class="success-icon-modal">‚úì</div>
            <div class="modal-header">
                <h3>Ponto Adicionado!</h3>
            </div>
            <div class="modal-body">
                <p><strong>Cliente:</strong> OLI001 - Jo√£o Silva</p>
                <div class="info-box-modal">
                    <span style="color: #999;">Pontos anteriores:</span> <strong>7/10</strong><br>
                    <span style="color: var(--verde);">Pontos atuais:</span> <strong style="color: var(--verde);">8/10</strong>
                </div>
                <p style="margin-top: 1rem; color: var(--dourado); font-weight: 600;">
                    Faltam 2 pontos para o lanche gr√°tis!
                </p>
            </div>
            <button class="btn btn-confirm" onclick="fecharModalSucesso()" style="width: 100%;">OK</button>
        </div>
    </div>

    <script>
        function searchCliente() {
            console.log('Pesquisando...');
        }

        function adicionarPonto() {
            document.getElementById('modalAdicionar').classList.add('show');
        }

        function fecharModal() {
            document.getElementById('modalAdicionar').classList.remove('show');
        }

        function confirmarPonto() {
            fecharModal();
            setTimeout(() => {
                document.getElementById('modalSucesso').classList.add('show');
            }, 300);
        }

        function fecharModalSucesso() {
            document.getElementById('modalSucesso').classList.remove('show');
            location.reload();
        }

        // Close on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });
        
        window.addEventListener('load', async () => {
            if (!await protegerPagina()) return;
            carregarEstatisticas();
            carregarClientesProximos();
        });

        document.querySelector('.btn-search').addEventListener('click', () => {
            executarPesquisa(document.getElementById('searchInput').value);
        });
    </script>
</body>
</html>
