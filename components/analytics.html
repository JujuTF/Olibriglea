<!-- Google Analytics 4 -->
<!-- 
    INSTRU√á√ïES:
    1. Criar conta em https://analytics.google.com
    2. Criar propriedade GA4
    3. Copiar o ID (formato: G-XXXXXXXXXX)
    4. Substituir 'G-XXXXXXXXXX' abaixo pelo seu ID real
-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SRH6QD9D4X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SRH6QD9D4X', {
    'cookie_flags': 'SameSite=None;Secure',
    'anonymize_ip': true // Para RGPD
  });
</script>

<!-- Microsoft Clarity (OPCIONAL - comentado por defeito) -->
<!--
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "SEU_CLARITY_ID");
</script>
-->

<!-- Eventos Customizados -->
<script>
// ============================================
// üìä Eventos Anal√≠ticos Personalizados
// ============================================

// Fun√ß√£o auxiliar para enviar eventos
function enviarEvento(categoria, acao, rotulo, valor) {
    if (typeof gtag !== 'undefined') {
        gtag('event', acao, {
            'event_category': categoria,
            'event_label': rotulo,
            'value': valor
        });
        console.log('üìä Evento:', categoria, '-', acao, '-', rotulo);
    }
}

// ============================================
// EVENTOS AUTOM√ÅTICOS
// ============================================

// Tempo na p√°gina
window.addEventListener('load', function() {
    const tempoInicio = Date.now();
    
    window.addEventListener('beforeunload', function() {
        const tempoTotal = Math.round((Date.now() - tempoInicio) / 1000);
        enviarEvento('Engajamento', 'tempo_na_pagina', window.location.pathname, tempoTotal);
    });
});

// Cliques em links externos
document.addEventListener('click', function(e) {
    const link = e.target.closest('a');
    if (link && link.href && link.href.startsWith('http') && !link.href.includes(window.location.hostname)) {
        enviarEvento('Navegacao', 'clique_externo', link.href);
    }
});

// Scroll profundidade
let maxScroll = 0;
window.addEventListener('scroll', function() {
    const scrollPercent = Math.round((window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100);
    if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
        if ([25, 50, 75, 100].includes(scrollPercent)) {
            enviarEvento('Engajamento', 'scroll', window.location.pathname, scrollPercent);
        }
    }
});

// ============================================
// EVENTOS ESPEC√çFICOS DO SITE
// ============================================

// Quando o DOM carregar
document.addEventListener('DOMContentLoaded', function() {
    
    // Login/Registo
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', function() {
            enviarEvento('Autenticacao', 'tentativa_login', 'formulario');
        });
    }
    
    const registerForm = document.getElementById('registerForm');
    if (registerForm) {
        registerForm.addEventListener('submit', function() {
            enviarEvento('Autenticacao', 'tentativa_registo', 'formulario');
        });
    }
    
    // Bot√µes CTA
    document.querySelectorAll('.btn-primary, .btn-secondary').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const texto = this.textContent.trim();
            enviarEvento('CTA', 'clique_botao', texto);
        });
    });
    
    // Ver ementa
    document.querySelectorAll('[href*="#ementa"]').forEach(function(link) {
        link.addEventListener('click', function() {
            enviarEvento('Navegacao', 'ver_ementa', 'link');
        });
    });
    
    // Contactos
    document.querySelectorAll('[href*="tel:"], [href*="mailto:"]').forEach(function(link) {
        link.addEventListener('click', function() {
            const tipo = this.href.startsWith('tel:') ? 'telefone' : 'email';
            enviarEvento('Contacto', 'clique_' + tipo, this.href);
        });
    });
});

// ============================================
// EXPORTAR FUN√á√ÉO PARA USO MANUAL
// ============================================
window.analytics = {
    evento: enviarEvento,
    
    // Atalhos comuns
    login: function() {
        enviarEvento('Autenticacao', 'login_sucesso', window.location.pathname);
    },
    
    logout: function() {
        enviarEvento('Autenticacao', 'logout', window.location.pathname);
    },
    
    registo: function(codigo) {
        enviarEvento('Autenticacao', 'registo_sucesso', codigo);
    },
    
    pontoAdicionado: function(total) {
        enviarEvento('Fidelizacao', 'ponto_adicionado', 'total_' + total, 1);
    },
    
    lancheResgatado: function(codigo) {
        enviarEvento('Fidelizacao', 'lanche_resgatado', codigo, 10);
    },
    
    erro: function(tipo, mensagem) {
        enviarEvento('Erro', tipo, mensagem);
    }
};

console.log('üìä Analytics inicializado');
</script>
